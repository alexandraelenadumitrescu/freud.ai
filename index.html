<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transylvania Blood Network</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Cinzel Decorative", serif;
        background-color: #0d0d0d;
        color: #f5f5f5;
        overflow-x: hidden;
        position: relative;
        background-image: url("https://images.unsplash.com/photo-1542848906-8809e6c38b25?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }

      /* Overlay to darken the background image */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: -1;
      }

      /* NEW: Initial Welcome Overlay Styles */
      #initial-welcome-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95); /* Foarte întunecat */
        z-index: 100000; /* Extrem de mare pentru a fi deasupra la tot */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #f5f5f5;
        text-align: center;
        opacity: 1;
        transition: opacity 1s ease-in-out, visibility 1s ease-in-out;
        visibility: visible;
      }

      #initial-welcome-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none; /* Dezactivează interacțiunile când este ascuns */
      }

      #initial-welcome-overlay .welcome-image {
        max-width: 80%;
        max-height: 50vh; /* Ajustează după nevoie */
        border: 3px solid #e60000;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
        border-radius: 8px;
        margin-bottom: 30px;
        object-fit: contain; /* Asigură că imaginea se potrivește bine */
      }

      #initial-welcome-overlay h2 {
        color: #e60000;
        font-size: 2.5em;
        margin-bottom: 15px;
        text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
      }

      #initial-welcome-overlay p {
        font-size: 1.2em;
        color: #ccc;
        margin-bottom: 40px;
        font-family: "Dancing Script", cursive; /* Un pic mai sinistru */
      }

      #initial-welcome-overlay button {
        background-color: #e60000;
        color: #f5f5f5;
        padding: 15px 30px;
        border: 2px solid #ff3333;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.3em;
        font-weight: bold;
        letter-spacing: 1px;
        transition: background-color 0.3s ease, transform 0.2s ease,
          box-shadow 0.3s ease;
      }

      #initial-welcome-overlay button:hover {
        background-color: #cc0000;
        transform: scale(1.05);
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.9);
      }

      header {
        background-color: #1a1a1a;
        padding: 20px;
        text-align: center;
        font-size: 32px;
        color: #e60000;
        position: sticky;
        top: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Styles for logo */
      .header-logo {
        height: 80px;
        width: auto;
        margin-right: 15px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
      }

      nav {
        background-color: #1a1a1a;
        padding: 10px;
        text-align: center;
        position: sticky;
        top: 72px; /* Adjusted to be below the header */
        z-index: 999;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        display: flex; /* Make nav items flexible */
        justify-content: center; /* Center nav items */
        align-items: center;
      }

      nav a {
        color: #ccc;
        margin: 0 15px;
        text-decoration: none;
        font-size: 1.1em;
        transition: color 0.3s ease;
      }

      nav a:hover {
        color: #e60000;
      }

      /* New: Chat Icon in Nav */
      #nav-chat-icon {
        color: #f5f5f5; /* Culoarea icoanei de chat */
        font-size: 1.5em;
        margin-left: 20px; /* Spațiu față de celelalte link-uri */
        cursor: pointer;
        transition: color 0.3s ease;
      }

      #nav-chat-icon:hover {
        color: #e60000; /* Culoare la hover */
      }

      section {
        padding: 40px;
        max-width: 700px;
        margin: auto;
        line-height: 1.6;
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        position: relative;
        z-index: 10;
      }

      h2 {
        color: #e60000;
        text-align: center;
        margin-bottom: 25px;
        font-size: 2em;
      }

      input,
      select,
      button,
      textarea {
        padding: 12px;
        margin-top: 10px;
        width: calc(100% - 24px);
        background: #2a2a2a;
        color: #f5f5f5;
        border: 1px solid #e60000;
        border-radius: 5px;
        font-family: "Cinzel Decorative", serif;
        font-size: 1em;
        transition: background 0.3s ease, border-color 0.3s ease,
          box-shadow 0.3s ease;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #ff3333;
        box-shadow: 0 0 8px rgba(255, 51, 51, 0.6);
      }

      button {
        background-color: #e60000;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        font-weight: bold;
        letter-spacing: 1px;
      }

      button:hover {
        background-color: #cc0000;
      }

      #letter {
        background-color: rgba(26, 26, 26, 0.8);
        padding: 20px;
        border: 1px dashed #e60000;
        margin-top: 20px;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(230, 0, 0, 0.3);
        white-space: pre-wrap;
      }

      /* New styles for handwriting effect */
      #output {
        font-family: "Dancing Script", cursive;
        font-size: 1.5em;
        color: #ccc;
        min-height: 200px;
      }

      /* Typing cursor effect */
      .typing-cursor::after {
        content: "|";
        display: inline-block;
        animation: blink-caret 0.75s infinite;
      }

      @keyframes blink-caret {
        from,
        to {
          border-color: transparent;
        }

        50% {
          border-color: #e60000;
        }
      }

      /* Styles for background bats */
      .bat {
        position: fixed;
        width: 60px;
        height: auto;
        pointer-events: none;
        opacity: 0.7;
        filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.3));
        z-index: 5;
      }

      @keyframes flyToRight {
        0% {
          transform: translateX(0vw) translateY(var(--startY)) scaleX(1);
          opacity: 0.7;
        }

        50% {
          transform: translateX(50vw) translateY(var(--midY)) scaleX(1);
        }

        100% {
          transform: translateX(100vw) translateY(var(--endY)) scaleX(1);
          opacity: 0.7;
        }
      }

      @keyframes flyToLeft {
        0% {
          transform: translateX(100vw) translateY(var(--startY)) scaleX(-1);
          opacity: 0.7;
        }

        50% {
          transform: translateX(50vw) translateY(var(--midY)) scaleX(-1);
        }

        100% {
          transform: translateX(0vw) translateY(var(--endY)) scaleX(-1);
          opacity: 0.7;
        }
      }

      /* Blood Drop Animation */
      .blood-drop {
        position: absolute;
        background-color: #e60000;
        border-radius: 50%;
        opacity: 0.8;
        pointer-events: none;
        animation: drip 1s ease-out forwards;
        filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.7));
      }

      @keyframes drip {
        0% {
          transform: translateY(0) scale(0.5);
          opacity: 0.8;
        }

        100% {
          transform: translateY(50px) scale(1);
          opacity: 0;
        }
      }

      /* Mist Effect on Scroll */
      .mist-overlay {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 0;
        background: linear-gradient(to top, rgba(230, 0, 0, 0.2), transparent);
        z-index: 20;
        pointer-events: none;
        transition: height 0.5s ease-out;
      }

      /* Mouse Glow */
      #mouse-glow {
        position: fixed;
        width: 50px;
        height: 50px;
        background-color: rgba(255, 0, 0, 0.1);
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        filter: blur(20px);
        z-index: 50;
        opacity: 0;
        transition: opacity 0.5s ease-out;
      }

      /* Sound Toggle Button */
      #sound-toggle-button {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background-color: #f5f5f5;
        border: none;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        z-index: 200;
        transition: background-color 0.3s ease, transform 0.2s ease,
          box-shadow 0.3s ease;
      }

      #sound-toggle-button:hover {
        background-color: #e0e0e0;
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
      }

      /* Styles for sound button images */
      #sound-toggle-button img {
        width: 35px;
        height: 35px;
        display: block;
        object-fit: contain;
      }

      /* Initially hide the sound-on icon - controlled by JS display property */
      #sound-on-icon {
        display: none;
      }

      /* Styles for the "Catch Vlad" game */
      #bat-catcher-game {
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        padding: 20px;
        text-align: center;
      }

      #game-area {
        width: 100%;
        height: 300px;
        border: 2px dashed #e60000;
        margin: 20px auto;
        position: relative;
        overflow: hidden;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
        cursor: crosshair;
      }

      /* Style for the game target image (now Vlad) */
      .game-bat {
        position: absolute;
        width: 80px;
        height: auto;
        cursor: pointer;
        transition: transform 0.1s ease-out;
        filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.5));
      }

      .game-bat:hover {
        transform: scale(1.1);
      }

      #game-info {
        display: flex;
        justify-content: space-around;
        margin-bottom: 15px;
        font-size: 1.2em;
        color: #f5f5f5;
      }

      #game-start-button {
        background-color: #008000;
        transition: background-color 0.3s ease;
      }

      #game-start-button:hover {
        background-color: #006400;
      }

      #game-start-button.disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      /* Transition Overlay Styles (for game) */
      #transition-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("dracula.jpeg");
        background-size: cover;
        background-position: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 1.5s ease-in-out;
      }

      /* Contact Form specific styles */
      #contact-us form label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        color: #e60000;
        font-weight: bold;
      }
      #contact-us textarea {
        min-height: 120px;
        resize: vertical;
      }
      #contact-us .success-message {
        margin-top: 20px;
        padding: 15px;
        background-color: rgba(0, 128, 0, 0.3);
        border: 1px solid #008000;
        border-radius: 5px;
        color: #f5f5f5;
        text-align: center;
        font-weight: bold;
        display: none;
      }

      /* Quiz Styles */
      #vampire-quiz {
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        padding: 20px;
      }

      .quiz-question {
        background-color: rgba(42, 42, 42, 0.7);
        border: 1px solid #550000;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
        text-align: left;
      }

      .quiz-question p {
        font-size: 1.1em;
        color: #f5f5f5;
        margin-bottom: 15px;
      }

      .quiz-options {
        display: grid;
        gap: 10px;
      }

      .quiz-options label {
        display: block;
        background: #2a2a2a;
        color: #ccc;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #e60000;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quiz-options label:hover {
        background-color: #3a0000;
        color: #fff;
      }

      .quiz-options input[type="radio"] {
        margin-right: 10px;
        accent-color: #e60000;
      }

      #submit-quiz {
        background-color: #e60000;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        font-weight: bold;
        letter-spacing: 1px;
        padding: 12px;
        border: none;
        border-radius: 5px;
        color: #f5f5f5;
        font-family: "Cinzel Decorative", serif;
        font-size: 1em;
        transition: background-color 0.3s ease;
      }

      #submit-quiz:hover {
        background-color: #cc0000;
      }

      #quiz-result {
        margin-top: 20px;
        text-align: center;
        font-size: 1.3em;
        color: #e60000;
        font-family: "Dancing Script", cursive;
      }

      #result-description {
        margin-top: 10px;
        text-align: center;
        color: #ccc;
        font-style: italic;
      }

      .quiz-progress {
        color: #ccc;
        text-align: center;
        margin-bottom: 15px;
        font-style: italic;
      }

      .quiz-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }

      .quiz-navigation button {
        background-color: #550000;
        color: #f5f5f5;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-family: "Cinzel Decorative", serif;
      }

      .quiz-navigation button:hover {
        background-color: #770000;
      }

      /* Countdown Timer Styles */
      #countdown-timer {
        background: linear-gradient(
          135deg,
          rgba(26, 26, 26, 0.95),
          rgba(42, 42, 42, 0.85)
        );
        border: 2px solid #e60000;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 0 30px rgba(230, 0, 0, 0.6),
          inset 0 0 20px rgba(0, 0, 0, 0.8);
        position: relative;
        overflow: hidden;
      }

      #countdown-timer::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #e60000, #ff3333, #cc0000, #e60000);
        border-radius: 15px;
        z-index: -1;
        animation: borderPulse 3s ease-in-out infinite;
      }

      @keyframes borderPulse {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }

      .countdown-title {
        font-size: 1.8em;
        color: #e60000;
        margin-bottom: 20px;
        text-shadow: 0 0 10px rgba(230, 0, 0, 0.8);
        letter-spacing: 2px;
      }

      .timer-display {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .time-unit {
        background: rgba(0, 0, 0, 0.8);
        border: 1px solid #e60000;
        border-radius: 10px;
        padding: 15px 10px;
        min-width: 80px;
        position: relative;
        overflow: hidden;
      }

      .time-unit::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(230, 0, 0, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .time-number {
        font-size: 2.5em;
        color: #f5f5f5;
        font-weight: bold;
        text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        display: block;
        line-height: 1;
        animation: numberGlow 2s ease-in-out infinite alternate;
      }

      @keyframes numberGlow {
        from {
          text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        }
        to {
          text-shadow: 0 0 25px rgba(255, 0, 0, 1),
            0 0 35px rgba(255, 0, 0, 0.5);
        }
      }

      .time-label {
        font-size: 0.9em;
        color: #ccc;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 5px;
      }

      .countdown-message {
        margin-bottom: 20px;
        font-size: 1.2em;
        color: #ccc;
        font-style: italic;
        min-height: 25px;
      }

      .countdown-finished {
        animation: finishedPulse 1s ease-in-out infinite;
        color: #ff3333 !important;
        font-weight: bold;
      }

      @keyframes finishedPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Demo button to test the countdown */
      .demo-button {
        background: linear-gradient(135deg, #e60000, #cc0000);
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        color: #f5f5f5;
        font-family: "Cinzel Decorative", serif;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 20px;
        width: 100%;
      }

      .demo-button:hover {
        background: linear-gradient(135deg, #ff3333, #e60000);
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.8);
        transform: translateY(-2px);
      }

      /* Responsive design */
      @media (max-width: 768px) {
        #initial-welcome-overlay .welcome-image {
          max-width: 90%;
          max-height: 40vh;
          margin-bottom: 20px;
        }
        #initial-welcome-overlay h2 {
          font-size: 1.8em;
        }
        #initial-welcome-overlay p {
          font-size: 1em;
          padding: 0 15px;
        }
        #initial-welcome-overlay button {
          font-size: 1em;
          padding: 12px 25px;
        }

        header {
          font-size: 24px;
          flex-direction: column;
        }

        .header-logo {
          height: 60px;
          margin-bottom: 10px;
          margin-right: 0;
        }

        section {
          padding: 20px;
          margin: 20px auto;
        }

        nav a {
          margin: 0 10px;
          font-size: 0.9em;
        }

        #sound-toggle-button {
          width: 50px;
          height: 50px;
          bottom: 10px;
          left: 10px;
        }

        #sound-toggle-button img {
          width: 28px;
          height: 28px;
        }

        #game-area {
          height: 200px;
        }

        #vampire-quiz {
          padding: 20px;
        }

        /* Countdown responsive styles */
        .timer-display {
          gap: 10px;
        }

        .time-unit {
          min-width: 70px;
          padding: 10px 5px;
        }

        .time-number {
          font-size: 2em;
        }

        .countdown-title {
          font-size: 1.5em;
        }

        /* Chat Window Responsive */
        #global-chat-window {
          width: 90%;
          right: 5%;
          bottom: 20px; /* Adjust if sound button interferes */
          height: 70vh; /* Make it taller on smaller screens */
          max-height: 500px;
        }

        #global-chat-window .chat-body {
          padding: 10px;
        }

        #global-chat-window #chat-input {
          padding: 8px;
        }

        #global-chat-window #send-message-button {
          padding: 8px 12px;
        }
      }

      /* NEW: Global Chat Window Styles */
      #global-chat-window {
        position: fixed;
        bottom: 25px; /* Adjust based on sound button and general layout */
        right: 25px;
        width: 380px;
        height: 500px;
        background-color: rgba(26, 26, 26, 0.95);
        border: 2px solid #e60000;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
        z-index: 10000; /* Higher than other elements, but below initial overlay */
        display: none; /* Hidden by default */
        flex-direction: column;
        overflow: hidden;
      }

      #global-chat-window.active {
        display: flex; /* Show when active */
      }

      .chat-header {
        background-color: #e60000;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.2em;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
      }

      .chat-header h3 {
        margin: 0;
        font-size: 1.1em;
      }

      .close-chat {
        cursor: pointer;
        font-size: 1.5em;
        font-weight: bold;
        transition: color 0.2s ease;
      }

      .close-chat:hover {
        color: #f0f0f0;
      }

      .chat-body {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #1a1a1a;
        border-bottom: 1px solid #550000;
        display: flex;
        flex-direction: column;
        gap: 10px; /* Space between messages */
      }

      .chat-message {
        background-color: #333;
        padding: 10px 15px;
        border-radius: 15px;
        max-width: 85%;
        word-wrap: break-word;
        font-size: 0.95em;
        line-height: 1.4;
        color: #f5f5f5;
        font-family: Arial, sans-serif; /* Simpler font for chat messages */
      }

      .chat-message.self {
        background-color: #0056b3; /* Your messages */
        align-self: flex-end; /* Align to right */
        border-bottom-right-radius: 5px;
      }

      .chat-message.other {
        background-color: #550000; /* Other users' messages */
        align-self: flex-start; /* Align to left */
        border-bottom-left-radius: 5px;
      }

      .chat-message strong {
        color: #e60000;
        margin-right: 5px;
      }

      .chat-message .blood-group {
        font-size: 0.8em;
        background-color: #ff3333;
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 5px;
        vertical-align: middle;
      }

      .chat-footer {
        display: flex;
        padding: 10px 15px;
        border-top: 1px solid #550000;
        background-color: #1a1a1a;
      }

      #chat-message-input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #e60000;
        border-radius: 20px;
        background-color: #2a2a2a;
        color: #f5f5f5;
        margin-right: 10px;
        font-family: Arial, sans-serif;
        font-size: 0.9em;
      }

      #send-message-button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 20px;
        cursor: pointer;
        font-family: "Cinzel Decorative", serif;
        font-size: 0.9em;
        transition: background-color 0.3s ease;
        width: auto; /* Override general button width */
        margin-top: 0; /* Override general button margin */
      }

      #send-message-button:hover {
        background-color: #218838;
      }

      /* Username input for chat */
      #chat-username-input-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 100001; /* Higher than chat window */
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
      }

      #chat-username-input-box {
        background-color: rgba(26, 26, 26, 0.95);
        border: 2px solid #e60000;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
        width: 300px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      #chat-username-input-box label {
        font-size: 1.2em;
        color: #e60000;
        margin-bottom: 10px;
      }

      #chat-username-input-box input[type="text"] {
        width: calc(100% - 20px);
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #e60000;
        background-color: #333;
        color: #f5f5f5;
      }

      #chat-username-input-box button {
        background-color: #e60000;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-family: "Cinzel Decorative", serif;
        font-size: 1em;
        width: 100%;
      }

      #chat-username-input-box button:hover {
        background-color: #cc0000;
      }
    </style>
</head>

<body>
    <div id="initial-welcome-overlay">
        <img src="dracula.jpeg" alt="Dracula Welcome" class="welcome-image" />
        <h2>Welcome to the Transylvania Blood Network.</h2>
        <p>Prepare to delve into the shadows...</p>
        <button id="enter-site-button">Enter at Your Own Risk</button>
    </div>

    <div id="bat-container"></div>
    <div id="mouse-glow"></div>
    <div class="mist-overlay" id="mist-overlay"></div>

    <div id="transition-overlay"></div>

    <audio id="bat-sound" loop>
        <source src="Toccata-and-fugue-in-d-minor.mp3" type="audio/mp3" />
        Your browser does not support the audio element.
    </audio>
    <audio id="drip-sound">
        <source src="water-drip-72357.mp3" type="audio/mp3" />
    </audio>
    <audio id="chime-sound">
        <source src="spooky-chimes-359877.mp3" type="audio/mp3" />
    </audio>
    <audio id="typing-sound">
        <source src="typewriter-100-88009.mp3" type="audio/mp3" />
        Your browser does not support the audio element.
    </audio>
    <audio id="wolf-howl-sound">
        <source src="wolf-howl.mp3" type="audio/mp3" />
        Your browser does not support the audio element.
    </audio>
    <audio id="evil-laugh-sound">
        <source src="evil-laugh-89423.mp3" type="audio/mp3" />
        Your browser does not support the audio element.
    </audio>

    <header>
        <img
            src="blood-donors-needed-halloween-dracula-volunteer-light-nikita-goel.jpg"
            alt="Transylvania Blood Network Logo"
            class="header-logo"
        />
        🩸 Transylvania Blood Network
    </header>

    <nav>
        <a href="#home">Home</a>
        <a href="#donate">Donate</a>
        <a href="#registered-donors">Donors</a>
        <a href="#facts-cravings">Secrets</a>
        <a href="#bat-catcher-game">Catch Vlad!</a>
        <a href="#vampire-quiz">Vampire Quiz</a>
        <a href="#countdown-section">Transformation</a>
        <a href="#letter">Your Letter</a>
        <a href="#contact-us">Contact</a>
        <a href="#about">About</a>
        <a href="#" id="nav-chat-icon" title="Open Chat">
            <i class="fas fa-comments"></i>
        </a>
    </nav>

    <section id="home">
        <h2>Welcome</h2>
        <p>
            Transylvania Blood Network connects generous donors with those who need
            them most. But more than blood, we deliver humanity, wrapped in a veil
            of ancient mystery. Every pulse, a story. Every drop, a destiny.
        </p>
    </section>

    <section id="donate">
        <h2>Become a Donor</h2>
        <label for="name">Your Name</label>
        <input type="text" id="name" placeholder="Enter your name..." />

        <label for="group">Blood Group</label>
        <select id="group">
            <option>A+</option>
            <option>A-</option>
            <option>B+</option>
            <option>B-</option>
            <option>AB+</option>
            <option>AB-</option>
            <option>O+</option>
            <option>O-</option>
        </select>

        <button onclick="submitDonor()">Generate Letter</button>
    </section>

    <section id="registered-donors">
        <h2>Registered Donors & Blood Inventory</h2>
        <div
            id="donor-list-container"
            style="
                max-height: 300px;
                overflow-y: auto;
                border: 1px solid #e60000;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 20px;
            "
        >
            <p id="no-donors-message" style="text-align: center; color: #ccc">
                No donors registered yet.
            </p>
            <ul id="donor-list" style="list-style-type: none; padding: 0"></ul>
        </div>
        <div
            id="blood-inventory"
            style="
                background-color: rgba(42, 42, 42, 0.8);
                padding: 15px;
                border-radius: 5px;
                border: 1px solid #e60000;
            "
        >
            <h3>Current Blood Inventory:</h3>
            <p id="inventory-summary" style="color: #f5f5f5">
                No blood data available.
            </p>
        </div>
        <button
            onclick="clearAllDonors()"
            style="margin-top: 20px; background-color: #550000"
        >
            Clear All Donors (Local)
        </button>
    </section>

    <section id="facts-cravings">
        <h2>Transylvanian Secrets & Cravings</h2>

        <h3>Random Vampire Fact:</h3>
        <button onclick="displayRandomVampireFact()">Reveal a Secret</button>
        <p
            id="vampire-fact-output"
            style="margin-top: 15px; font-style: italic; color: #ccc"
        >
            Click to uncover ancient truths.
        </p>

        <h3 style="margin-top: 30px">Blood Type Craving Compatibility:</h3>
        <label for="craving-group">Select Blood Type:</label>
        <select id="craving-group">
            <option>A+</option>
            <option>A-</option>
            <option>B+</option>
            <option>B-</option>
            <option>AB+</option>
            <option>AB-</option>
            <option>O+</option>
            <option>O-</option>
        </select>
        <button onclick="getBloodCraving()">Discover Cravings</button>
        <p
            id="craving-output"
            style="margin-top: 15px; font-style: italic; color: #ccc"
        >
            What will your blood crave tonight?
        </p>
    </section>

    <section id="bat-catcher-game">
        <h2>Catch Vlad!</h2>
        <p>
            Click on Vlad Tepes as fast as you can to score points before time runs
            out!
        </p>
        <div id="game-info">
            <span id="score-display">Score: 0</span>
            <span id="timer-display">Time: 30s</span>
        </div>
        <div id="game-area"></div>
        <button id="game-start-button">Start Game!</button>
    </section>

    <section id="vampire-quiz">
        <h2>How Much Vampire Are You?</h2>
        <p class="quiz-progress" id="quiz-progress">Question 1 of 10</p>
        <div id="quiz-container"></div>
        <div class="quiz-navigation" id="quiz-navigation">
            <button id="prev-question" style="display: none">← Previous</button>
            <button id="next-question">Next →</button>
        </div>
        <button id="submit-quiz" style="display: none">
            Reveal Your True Nature
        </button>
        <div id="quiz-result"></div>
        <div id="result-description"></div>
    </section>

    <section id="countdown-section">
        <h2>Transformation Countdown</h2>
        <div id="countdown-timer">
            <div class="countdown-title">⏰ Time Until Next Blood Moon</div>

            <div class="timer-display">
                <div class="time-unit">
                    <span class="time-number" id="days">00</span>
                    <div class="time-label">Days</div>
                </div>
                <div class="time-unit">
                    <span class="time-number" id="hours">00</span>
                    <div class="time-label">Hours</div>
                </div>
                <div class="time-unit">
                    <span class="time-number" id="minutes">00</span>
                    <div class="time-label">Minutes</div>
                </div>
                <div class="time-unit">
                    <span class="time-number" id="seconds">00</span>
                    <div class="time-label">Seconds</div>
                </div>
            </div>

            <div class="countdown-message" id="countdown-message">
                Register as a donor to begin your mystical transformation countdown...
            </div>

            <button class="demo-button" onclick="startDemoCountdown()">
                🩸 Become a Donor (Demo)
            </button>
        </div>
    </section>

    <section id="letter">
        <h2>Your Letter</h2>
        <div id="output">Fill in your data above to see your letter.</div>
    </section>

    <section id="contact-us">
        <h2>Send a Message</h2>
        <p>
            Do you have a question, a secret to share, or an eerie suggestion? Send
            us a raven message!
        </p>
        <form id="contact-form">
            <label for="contact-name">Your Name</label>
            <input
                type="text"
                id="contact-name"
                placeholder="Enter your name..."
                required
            />

            <label for="contact-email">Your Email</label>
            <input
                type="email"
                id="contact-email"
                placeholder="Enter your email..."
                required
            />

            <label for="contact-message">Your Message</label>
            <textarea
                id="contact-message"
                placeholder="Type your message here..."
                required
            ></textarea>

            <button type="submit">Send Message</button>
            <div id="contact-success-message" class="success-message"></div>
        </form>
    </section>

    <section id="about">
        <h2>About</h2>
        <p>
            This web app was created in a 48h hackathon by a team of beginner
            developers from Romania. Inspired by our culture and humanity, we
            believe every drop tells a story. And perhaps, awakens something more
            primal within us all.
        </p>
    </section>

    <button id="sound-toggle-button" aria-label="Toggle Sound">
        <img
            id="sound-off-icon"
            src="haut-parleur-rouge-et-icone-sonore.png"
            alt="Sound Off"
        />
        <img
            id="sound-on-icon"
            src="icone-du-son-si-difuzor-rosu.png"
            alt="Sound On"
        />
    </button>

    <div id="global-chat-window">
        <div class="chat-header">
            <h3>Bloodline Chat</h3>
            <span class="close-chat">&times;</span>
        </div>
        <div class="chat-body" id="chat-messages-container">
            </div>
        <div class="chat-footer">
            <input
                type="text"
                id="chat-message-input"
                placeholder="Type your message..."
            />
            <button id="send-message-button">Send</button>
        </div>
    </div>

    <div id="chat-username-input-overlay" style="display: none;">
        <div id="chat-username-input-box">
            <label for="chat-username-setup">Enter your chat name:</label>
            <input type="text" id="chat-username-setup" placeholder="Your Name" />
            <button id="set-chat-username-button">Start Chatting</button>
        </div>
    </div>

    <script>
        const templates = [
            // Original Templates
            "Dear stranger,\\n\\nA part of me now lives in you. In this silent exchange, I hope you find strength. May your journey be long and filled with hidden wonders.\\n\\n– Someone who believes in you, from the shadows.",
            "You may never know my name, but my blood runs with hope. Let this be more than survival — let it be transformation. Embrace the night.",
            "We may never meet. But in this quiet act, I've shared life. Keep moving. Keep feeling. The ancient currents flow through us all.\\n\\n– A quiet ally, cloaked in starlight.",
            "They say blood is thicker than water. I say it's thicker than distance, thicker than time. I'm with you. Always. A hidden guardian watches over.",
            "My veins whispered: share. So I did. You're not alone. Someone out there cares, in ways you cannot yet comprehend. Embrace the mystery.",
            // New "Funny/Weird" Templates
            "Dearest Donor,\\n\\nYour generosity is... intoxicating. I've already felt a peculiar urge to organize my dusty crypt collection. Coincidence? I think not. Perhaps we'll share a moonlit stroll soon.\\n\\n— A Grateful (and slightly odd) Recipient.",
            "To the Brave One,\\n\\nThank you. My spectral librarian now has enough energy to alphabetize the scrolls of ancient curses. And I finally have the strength to rearrange my coffin. So much tidier now!\\n\\n— Lord Vlad (he prefers 'Vlad').",
            "Greetings,\\n\\nYour donation has significantly improved my nightly levitation practice. I can now float at least two inches higher! Expect an invitation to our next 'Midnight Picnic for the Peculiar'.\\n\\n— The Nocturnal Neighbor.",
            "A word of caution, dear donor: you might develop a sudden fondness for rare steak, avoiding garlic, or finding dusty corners strangely appealing. It's just... the transfusion. Nothing to worry about. Probably.\\n\\n— Sincerely, The Transylvanian Blood Bank (definitely human).",
            "Recipient,\\n\\nThe transfusion went splendidly! My last craving for ancient dust has subsided, replaced by an inexplicable desire for strong, dark coffee. Coincidence? Or the true power of O-negative?\\n\\n— Anonymously Yours (but mostly Nocturnal).",
            "This blood… it sings! Or perhaps that's just the ancient echoes within these castle walls. Anyway, thank you. I now feel empowered to finally learn to play the pipe organ. Loudly. All night.\\n\\n— Your New, Energetic Friend.",
        ];

        let typingInterval; // To hold the interval for typing effect

        // --- Core Site Functionality ---
        document.addEventListener("DOMContentLoaded", () => {
            const enterSiteButton = document.getElementById("enter-site-button");
            const initialWelcomeOverlay = document.getElementById(
                "initial-welcome-overlay"
            );
            const batSound = document.getElementById("bat-sound");
            const dripSound = document.getElementById("drip-sound");
            const chimeSound = document.getElementById("chime-sound");
            const typingSound = document.getElementById("typing-sound");
            const wolfHowlSound = document.getElementById("wolf-howl-sound");
            const evilLaughSound = document.getElementById("evil-laugh-sound");

            // Sound Toggle
            const soundToggleButton = document.getElementById("sound-toggle-button");
            const soundOffIcon = document.getElementById("sound-off-icon");
            const soundOnIcon = document.getElementById("sound-on-icon");
            let isSoundOn = false; // Initial state

            // Check localStorage for sound preference
            const savedSoundPreference = localStorage.getItem('isSoundOn');
            if (savedSoundPreference === 'true') {
                isSoundOn = true;
                soundOnIcon.style.display = 'block';
                soundOffIcon.style.display = 'none';
            } else {
                isSoundOn = false;
                soundOnIcon.style.display = 'none';
                soundOffIcon.style.display = 'block';
            }


            enterSiteButton.addEventListener("click", () => {
                initialWelcomeOverlay.classList.add("hidden");
                // Play main background music if sound is enabled
                if (isSoundOn) {
                    batSound.play().catch(e => console.log("Audio play prevented:", e));
                }
            });

            soundToggleButton.addEventListener("click", () => {
                isSoundOn = !isSoundOn;
                if (isSoundOn) {
                    soundOnIcon.style.display = "block";
                    soundOffIcon.style.display = "none";
                    batSound.play().catch(e => console.log("Audio play prevented:", e));
                } else {
                    soundOnIcon.style.display = "none";
                    soundOffIcon.style.display = "block";
                    batSound.pause();
                    batSound.currentTime = 0; // Reset audio
                }
                localStorage.setItem('isSoundOn', isSoundOn); // Save preference
            });


            // Typing effect for the letter
            const outputDiv = document.getElementById("output");
            const typeText = (element, text, delay = 50) => {
                let i = 0;
                element.innerHTML = ""; // Clear previous content
                element.classList.add("typing-cursor");

                if (typingInterval) {
                    clearInterval(typingInterval);
                }
                if (isSoundOn) {
                    typingSound.play();
                }

                typingInterval = setInterval(() => {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingInterval);
                        element.classList.remove("typing-cursor");
                        if (isSoundOn) {
                            typingSound.pause();
                            typingSound.currentTime = 0;
                        }
                    }
                }, delay);
            };

            // Bats flying in background
            const batContainer = document.getElementById("bat-container");
            const createBat = () => {
                const bat = document.createElement("img");
                bat.src = "bat.gif"; // Assuming you have a bat.gif
                bat.classList.add("bat");
                bat.style.position = "absolute";
                const startY = Math.random() * (window.innerHeight * 0.8);
                const midY = Math.random() * (window.innerHeight * 0.8);
                const endY = Math.random() * (window.innerHeight * 0.8);
                const duration = 10 + Math.random() * 10; // 10-20 seconds

                bat.style.setProperty("--startY", `${startY}px`);
                bat.style.setProperty("--midY", `${midY}px`);
                bat.style.setProperty("--endY", `${endY}px`);

                if (Math.random() > 0.5) {
                    // Fly right to left
                    bat.style.left = "100vw";
                    bat.style.animation = `flyToLeft ${duration}s linear infinite`;
                    bat.style.transform = "scaleX(-1)"; // Flip bat horizontally
                } else {
                    // Fly left to right
                    bat.style.left = "-10vw";
                    bat.style.animation = `flyToRight ${duration}s linear infinite`;
                }

                bat.style.top = `${startY}px`;
                batContainer.appendChild(bat);

                // Remove bat after animation to prevent accumulation
                setTimeout(() => {
                    bat.remove();
                }, duration * 1000);
            };

            // Create a few bats initially
            for (let i = 0; i < 5; i++) {
                setTimeout(createBat, Math.random() * 5000);
            }
            // Create new bats periodically
            setInterval(createBat, 5000); // New bat every 5 seconds

            // Mist effect on scroll
            const mistOverlay = document.getElementById("mist-overlay");
            window.addEventListener("scroll", () => {
                const scrollPercentage =
                    window.scrollY / (document.body.scrollHeight - window.innerHeight);
                const maxHeight = 300; // Max height of the mist
                mistOverlay.style.height = `${scrollPercentage * maxHeight}px`;
            });

            // Mouse glow effect
            const mouseGlow = document.getElementById("mouse-glow");
            let mouseTimeout;
            document.addEventListener("mousemove", (e) => {
                mouseGlow.style.left = `${e.clientX}px`;
                mouseGlow.style.top = `${e.clientY}px`;
                mouseGlow.style.opacity = "1"; // Show glow on mouse move

                clearTimeout(mouseTimeout);
                mouseTimeout = setTimeout(() => {
                    mouseGlow.style.opacity = "0"; // Fade out after inactivity
                }, 100);
            });

            // Blood Drip on Click
            document.addEventListener("click", (e) => {
                const drop = document.createElement("div");
                drop.classList.add("blood-drop");
                drop.style.width = drop.style.height = `${10 + Math.random() * 10}px`;
                drop.style.left = `${e.clientX}px`;
                drop.style.top = `${e.clientY}px`;
                document.body.appendChild(drop);

                if (isSoundOn) {
                    dripSound.currentTime = 0; // Reset sound for quick successive clicks
                    dripSound.play();
                }

                drop.addEventListener("animationend", () => {
                    drop.remove();
                });
            });

            // --- Contact Form ---
            const contactForm = document.getElementById("contact-form");
            const contactSuccessMessage = document.getElementById(
                "contact-success-message"
            );

            contactForm.addEventListener("submit", (event) => {
                event.preventDefault(); // Prevent default form submission

                contactSuccessMessage.textContent = "Raven message sent! We'll be in touch... eventually.";
                contactSuccessMessage.style.display = "block"; // Show message
                if (isSoundOn) {
                    chimeSound.play(); // Play a success sound
                }
                contactForm.reset(); // Clear the form

                setTimeout(() => {
                    contactSuccessMessage.style.display = "none";
                }, 5000); // Hide message after 5 seconds
            });

            // --- Vampire Quiz ---
            const quizQuestions = [
                {
                    question: "When do you feel most energetic?",
                    options: [
                        "A) During the day, under the sun.",
                        "B) At dusk, as shadows lengthen.",
                        "C) In the dead of night.",
                        "D) Whenever there's good coffee.",
                    ],
                    vampireScore: [0, 1, 2, 0],
                },
                {
                    question: "What's your preferred diet?",
                    options: [
                        "A) A balanced diet with lots of garlic.",
                        "B) Mostly proteins, well-done.",
                        "C) Rare steak, or anything that drips.",
                        "D) Anything a human would eat, mostly.",
                    ],
                    vampireScore: [0, 0, 2, 1],
                },
                {
                    question: "How do you react to sunlight?",
                    options: [
                        "A) Love it, can't get enough!",
                        "B) I prefer shade, but it's tolerable.",
                        "C) It irritates my skin and eyes; I avoid it.",
                        "D) I get a bit sleepy in direct sun.",
                    ],
                    vampireScore: [0, 1, 2, 0],
                },
                {
                    question: "What's your ideal living situation?",
                    options: [
                        "A) A sunny cottage with a garden.",
                        "B) A cozy home, good curtains are a must.",
                        "C) A secluded castle or ancient crypt.",
                        "D) Anywhere comfortable, really.",
                    ],
                    vampireScore: [0, 1, 2, 0],
                },
                {
                    question: "Your favorite animal is...",
                    options: [
                        "A) A golden retriever.",
                        "B) A cat.",
                        "C) A bat or a wolf.",
                        "D) A houseplant (low maintenance).",
                    ],
                    vampireScore: [0, 0, 2, 0],
                },
                {
                    question: "What type of fashion appeals to you most?",
                    options: [
                        "A) Bright and cheerful.",
                        "B) Comfortable and practical.",
                        "C) Elegant, dark, and timeless.",
                        "D) Whatever's trending.",
                    ],
                    vampireScore: [0, 0, 2, 0],
                },
                {
                    question: "How do you handle mirrors?",
                    options: [
                        "A) Perfectly normal, I check my outfit.",
                        "B) I use them, but don't obsess.",
                        "C) I avoid them; they never quite capture my... essence.",
                        "D) They're fine, but selfies are better.",
                    ],
                    vampireScore: [0, 0, 2, 0],
                },
                {
                    question: "Your social life consists of...",
                    options: [
                        "A) Lots of daytime gatherings.",
                        "B) Evening dinners with friends.",
                        "C) Exclusive nocturnal gatherings, by invitation only.",
                        "D) Binge-watching shows alone.",
                    ],
                    vampireScore: [0, 1, 2, 0],
                },
                {
                    question: "If you heard a wolf howl, you would...",
                    options: [
                        "A) Be slightly scared.",
                        "B) Be curious.",
                        "C) Feel a deep, primal connection.",
                        "D) Check if it's on TV.",
                    ],
                    vampireScore: [0, 1, 2, 0],
                },
                {
                    question: "What's your biggest fear?",
                    options: [
                        "A) Public speaking.",
                        "B) Spiders.",
                        "C) Wooden stakes and silver.",
                        "D) Running out of Wi-Fi.",
                    ],
                    vampireScore: [0, 0, 2, 0],
                },
            ];

            let currentQuestionIndex = 0;
            let totalVampireScore = 0;
            let quizAnswers = new Array(quizQuestions.length).fill(null); // To store selected answers

            const quizContainer = document.getElementById("quiz-container");
            const quizProgress = document.getElementById("quiz-progress");
            const prevQuestionButton = document.getElementById("prev-question");
            const nextQuestionButton = document.getElementById("next-question");
            const submitQuizButton = document.getElementById("submit-quiz");
            const quizResultDiv = document.getElementById("quiz-result");
            const resultDescriptionDiv = document.getElementById("result-description");

            const renderQuestion = () => {
                if (currentQuestionIndex < quizQuestions.length) {
                    const q = quizQuestions[currentQuestionIndex];
                    let questionHtml = `<div class="quiz-question">
                                        <p>${
                                            currentQuestionIndex + 1
                                        }. ${q.question}</p>
                                        <div class="quiz-options">`;
                    q.options.forEach((option, index) => {
                        const uniqueId = `q${currentQuestionIndex}-opt${index}`;
                        const isChecked =
                            quizAnswers[currentQuestionIndex] === index ? "checked" : "";
                        questionHtml += `
                            <label for="${uniqueId}">
                                <input type="radio" id="${uniqueId}" name="question${currentQuestionIndex}" value="${index}" ${isChecked}>
                                ${option}
                            </label>
                        `;
                    });
                    questionHtml += `</div></div>`;
                    quizContainer.innerHTML = questionHtml;
                    quizProgress.textContent = `Question ${
                        currentQuestionIndex + 1
                    } of ${quizQuestions.length}`;

                    // Add event listeners for radio buttons
                    document
                        .querySelectorAll(
                            `input[name="question${currentQuestionIndex}"]`
                        )
                        .forEach((radio) => {
                            radio.addEventListener("change", (event) => {
                                quizAnswers[currentQuestionIndex] = parseInt(
                                    event.target.value
                                );
                                // Enable next button if an answer is selected
                                if (quizAnswers[currentQuestionIndex] !== null) {
                                    nextQuestionButton.disabled = false;
                                }
                            });
                        });

                    // Update navigation button visibility and disabled state
                    prevQuestionButton.style.display =
                        currentQuestionIndex > 0 ? "inline-block" : "none";
                    nextQuestionButton.style.display = "inline-block";
                    submitQuizButton.style.display = "none"; // Hide submit until last question

                    // Disable next button if current question is not answered
                    nextQuestionButton.disabled =
                        quizAnswers[currentQuestionIndex] === null;

                    if (currentQuestionIndex === quizQuestions.length - 1) {
                        nextQuestionButton.style.display = "none";
                        submitQuizButton.style.display = "inline-block";
                        // Enable submit button only if the last question is answered
                        submitQuizButton.disabled =
                            quizAnswers[currentQuestionIndex] === null;
                    }
                }
            };

            const calculateResult = () => {
                totalVampireScore = 0;
                quizQuestions.forEach((q, qIndex) => {
                    const selectedOptionIndex = quizAnswers[qIndex];
                    if (selectedOptionIndex !== null) {
                        totalVampireScore += q.vampireScore[selectedOptionIndex];
                    }
                });

                const maxScore = quizQuestions.length * 2; // Each question max score is 2
                const percentage = (totalVampireScore / maxScore) * 100;

                let resultText = "";
                let resultDesc = "";

                if (percentage >= 80) {
                    resultText = "You are a True Child of the Night!";
                    resultDesc =
                        "Your essence resonates deeply with the ancient bloodlines. Embrace your destiny, for the shadows call to you.";
                    if (isSoundOn) {
                        evilLaughSound.play();
                    }
                } else if (percentage >= 50) {
                    resultText = "You Have Vampire Tendencies.";
                    resultDesc =
                        "The darkness stirs within you, but you still cling to the light. You are on the edge of a thrilling transformation.";
                } else if (percentage >= 20) {
                    resultText = "A Human with a Touch of the Macabre.";
                    resultDesc =
                        "You appreciate the gothic and mysterious, but your pulse still beats strongly with human vitality. Keep an eye out for strange cravings!";
                } else {
                    resultText = "Definitely Human (For Now...).";
                    resultDesc =
                        "Your human spirit shines bright, perhaps too bright for the night creatures. Don't worry, the garlic will protect you... maybe.";
                }

                quizResultDiv.textContent = resultText;
                resultDescriptionDiv.textContent = resultDesc;
                quizResultDiv.style.display = "block";
                resultDescriptionDiv.style.display = "block";

                // Hide quiz navigation and submit button after results are shown
                quizNavigation.style.display = "none";
                submitQuizButton.style.display = "none";
                quizProgress.style.display = "none";
            };

            nextQuestionButton.addEventListener("click", () => {
                if (currentQuestionIndex < quizQuestions.length - 1) {
                    currentQuestionIndex++;
                    renderQuestion();
                }
            });

            prevQuestionButton.addEventListener("click", () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    renderQuestion();
                }
            });

            submitQuizButton.addEventListener("click", calculateResult);

            renderQuestion(); // Initial render

            // --- Countdown Timer ---
            const daysSpan = document.getElementById("days");
            const hoursSpan = document.getElementById("hours");
            const minutesSpan = document.getElementById("minutes");
            const secondsSpan = document.getElementById("seconds");
            const countdownMessage = document.getElementById("countdown-message");
            let countdownInterval;

            // Set a target date and time (e.g., next Halloween in Liteni, Suceava County, Romania)
            // Liteni is in EEST (Eastern European Summer Time), which is UTC+3 in summer.
            // Let's pick a fixed date for the demo, like Halloween 2025.
            const targetDate = new Date("2025-10-31T00:00:00+03:00").getTime(); // Halloween 2025 at midnight EEST

            function updateCountdown() {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownMessage.textContent =
                        "The Blood Moon rises! Your transformation is complete!";
                    countdownMessage.classList.add("countdown-finished");
                    daysSpan.textContent =
                        hoursSpan.textContent =
                        minutesSpan.textContent =
                        secondsSpan.textContent =
                            "00";
                    if (isSoundOn) {
                        wolfHowlSound.play(); // Play a spooky sound when countdown finishes
                    }
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor(
                    (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
                );
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                daysSpan.textContent = String(days).padStart(2, "0");
                hoursSpan.textContent = String(hours).padStart(2, "0");
                minutesSpan.textContent = String(minutes).padStart(2, "0");
                secondsSpan.textContent = String(seconds).padStart(2, "0");
            }

            // Function to start the countdown (e.g., when a donor registers)
            window.startDemoCountdown = () => {
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
                countdownMessage.textContent =
                    "The countdown to the next Blood Moon has begun!";
                countdownMessage.classList.remove("countdown-finished");
                countdownInterval = setInterval(updateCountdown, 1000);
                updateCountdown(); // Initial call to display immediately
            };

            // Call it once on load to display initial countdown (or "00" if already passed)
            updateCountdown();

            // --- Bat Catcher Game ---
            const gameArea = document.getElementById("game-area");
            const gameStartButton = document.getElementById("game-start-button");
            const scoreDisplay = document.getElementById("score-display");
            const timerDisplay = document.getElementById("timer-display");
            const transitionOverlay = document.getElementById("transition-overlay");

            let score = 0;
            let gameTimer = 30; // seconds
            let gameInterval;
            let batSpawnInterval;
            let isGameRunning = false;

            const spawnBat = () => {
                if (!isGameRunning) return;

                const bat = document.createElement("img");
                bat.src = "dracula_head.png"; // Use Dracula's head as the target
                bat.classList.add("game-bat");

                const maxX = gameArea.offsetWidth - 80; // 80px is bat width
                const maxY = gameArea.offsetHeight - 80; // 80px is bat height

                bat.style.left = `${Math.random() * maxX}px`;
                bat.style.top = `${Math.random() * maxY}px`;

                // Set random duration for how long the bat stays
                const stayDuration = 800 + Math.random() * 1200; // 0.8 to 2 seconds

                gameArea.appendChild(bat);

                bat.addEventListener("click", () => {
                    if (isGameRunning) {
                        score++;
                        scoreDisplay.textContent = `Score: ${score}`;
                        bat.remove(); // Remove clicked bat
                        if (isSoundOn) {
                            dripSound.currentTime = 0; // Play drip sound on hit
                            dripSound.play();
                        }
                    }
                });

                // Remove bat if not clicked within its stayDuration
                setTimeout(() => {
                    if (bat.parentNode === gameArea) {
                        bat.remove();
                    }
                }, stayDuration);
            };

            const startGame = () => {
                isGameRunning = true;
                score = 0;
                gameTimer = 30;
                scoreDisplay.textContent = `Score: ${score}`;
                timerDisplay.textContent = `Time: ${gameTimer}s`;
                gameStartButton.disabled = true;
                gameStartButton.classList.add("disabled");
                gameArea.innerHTML = ""; // Clear any lingering bats

                gameInterval = setInterval(() => {
                    gameTimer--;
                    timerDisplay.textContent = `Time: ${gameTimer}s`;

                    if (gameTimer <= 0) {
                        endGame();
                    }
                }, 1000);

                batSpawnInterval = setInterval(spawnBat, 700); // Spawn a bat every 0.7 seconds
                transitionOverlay.style.opacity = "1"; // Show overlay
                transitionOverlay.style.visibility = "visible";
                setTimeout(() => {
                    transitionOverlay.style.opacity = "0"; // Fade out
                    transitionOverlay.style.visibility = "hidden";
                }, 1500); // Keep overlay for 1.5 seconds

                if (isSoundOn) {
                    wolfHowlSound.play().catch(e => console.log("Audio play prevented:", e));
                }
            };

            const endGame = () => {
                isGameRunning = false;
                clearInterval(gameInterval);
                clearInterval(batSpawnInterval);
                gameStartButton.disabled = false;
                gameStartButton.classList.remove("disabled");
                gameArea.innerHTML = ""; // Clear all bats
                alert(`Game Over! You caught ${score} Vlad(s)!`);
            };

            gameStartButton.addEventListener("click", startGame);

            // --- Donor Registration and List ---
            const donorNameInput = document.getElementById("name");
            const bloodGroupSelect = document.getElementById("group");
            const donorListUl = document.getElementById("donor-list");
            const noDonorsMessage = document.getElementById("no-donors-message");
            const inventorySummary = document.getElementById("inventory-summary");

            let donors = JSON.parse(localStorage.getItem("donors")) || [];

            const updateDonorList = () => {
                donorListUl.innerHTML = "";
                if (donors.length === 0) {
                    noDonorsMessage.style.display = "block";
                } else {
                    noDonorsMessage.style.display = "none";
                    donors.forEach((donor) => {
                        const li = document.createElement("li");
                        li.style.cssText = `
                            background-color: rgba(42, 42, 42, 0.7);
                            padding: 8px 12px;
                            margin-bottom: 5px;
                            border-radius: 5px;
                            border: 1px solid #e60000;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            font-family: Arial, sans-serif;
                            font-size: 0.95em;
                        `;
                        li.innerHTML = `
                            <span>${donor.name} <span style="background-color: #ff3333; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-left: 5px;">${donor.group}</span></span>
                            <button onclick="removeDonor('${donor.id}')" style="background-color: #cc0000; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.8em; margin-top: 0; width: auto;">Remove</button>
                        `;
                        donorListUl.appendChild(li);
                    });
                }
                updateBloodInventory();
            };

            const updateBloodInventory = () => {
                const inventory = {};
                donors.forEach((donor) => {
                    inventory[donor.group] = (inventory[donor.group] || 0) + 1;
                });

                let summaryText = "";
                if (Object.keys(inventory).length === 0) {
                    summaryText = "No blood data available.";
                } else {
                    for (const group in inventory) {
                        summaryText += `${group}: ${inventory[group]} units<br>`;
                    }
                }
                inventorySummary.innerHTML = summaryText;
            };

            window.submitDonor = () => {
                const name = donorNameInput.value.trim();
                const group = bloodGroupSelect.value;
                if (name) {
                    const newDonor = {
                        id: Date.now().toString(), // Simple unique ID
                        name: name,
                        group: group,
                        isDonor: true, // Flag for chat
                    };
                    donors.push(newDonor);
                    localStorage.setItem("donors", JSON.stringify(donors));
                    updateDonorList();
                    donorNameInput.value = "";
                    typeText(
                        outputDiv,
                        templates[Math.floor(Math.random() * templates.length)]
                    );

                    // Add a system message to the chat about the new donor
                    addChatMessage(
                        "system",
                        `${name} (${group}) has joined the Blood Network!`,
                        "system" // Use a specific class for system messages
                    );

                    // If chat username is not set, set it to the donor's name
                    if (!localStorage.getItem('chatUsername')) {
                        localStorage.setItem('chatUsername', name);
                        localStorage.setItem('chatUserBloodGroup', group);
                        // Optionally hide username input overlay if it was shown for chat
                        document.getElementById('chat-username-input-overlay').style.display = 'none';
                    }
                } else {
                    alert("Please enter your name!");
                }
            };

            window.removeDonor = (id) => {
                donors = donors.filter((donor) => donor.id !== id);
                localStorage.setItem("donors", JSON.stringify(donors));
                updateDonorList();
            };

            updateDonorList(); // Initial load of donor list

            // --- Random Vampire Fact ---
            const vampireFacts = [
                "The word 'vampire' first appeared in English in 1734.",
                "In some folklore, vampires can be repelled by mustard seeds.",
                "Bram Stoker's Dracula was inspired by Eastern European folklore and Vlad the Impaler.",
                "Garlic is believed to ward off vampires due to its strong odor, which they supposedly find offensive.",
                "Vampires are often depicted as unable to cross running water without assistance.",
                "Mirrors are said to reveal no reflection of a vampire, as they lack a soul.",
                "In Haitian Vodou, a 'loogaroo' is a female vampire who sheds her skin at night.",
                "The 'Nosferatu' is another name for a vampire, popularized by the 1922 silent film.",
                "Some legends claim vampires can transform into bats, wolves, or mist.",
                "The fear of vampires is known as 'vampirophobia'.",
            ];

            const vampireFactOutput = document.getElementById("vampire-fact-output");

            window.displayRandomVampireFact = () => {
                const randomIndex = Math.floor(Math.random() * vampireFacts.length);
                vampireFactOutput.textContent = vampireFacts[randomIndex];
            };

            // --- Blood Type Craving Compatibility ---
            const bloodCravings = {
                "A+": "Craves fresh berries and the thrill of new beginnings.",
                "A-": "Desires ancient wines and forgotten secrets.",
                "B+": "Longs for exotic spices and untamed wilderness.",
                "B-": "Pines for bitter chocolate and forbidden knowledge.",
                "AB+": "Seeks balance, perhaps a taste of moonlight and shadow.",
                "AB-": "Yearns for icy winds and untold mysteries.",
                "O+": "Needs strong coffee and the vigor of the hunt.",
                "O-": "Hungers for the very essence of life, pure and undiluted.",
            };

            const cravingGroupSelect = document.getElementById("craving-group");
            const cravingOutput = document.getElementById("craving-output");

            window.getBloodCraving = () => {
                const selectedGroup = cravingGroupSelect.value;
                cravingOutput.textContent = bloodCravings[selectedGroup];
            };

            // --- NEW: Global Chat Functionality ---
            const navChatIcon = document.getElementById("nav-chat-icon");
            const globalChatWindow = document.getElementById("global-chat-window");
            const closeChat = globalChatWindow.querySelector(".close-chat");
            const chatMessagesContainer = document.getElementById("chat-messages-container");
            const chatMessageInput = document.getElementById("chat-message-input");
            const sendMessageButton = document.getElementById("send-message-button");
            const chatUsernameInputOverlay = document.getElementById("chat-username-input-overlay");
            const chatUsernameSetup = document.getElementById("chat-username-setup");
            const setChatUsernameButton = document.getElementById("set-chat-username-button");

            let chatUsername = localStorage.getItem("chatUsername");
            let chatUserBloodGroup = localStorage.getItem("chatUserBloodGroup");
            let chatMessages = JSON.parse(localStorage.getItem("chatMessages")) || [];

            // Display stored messages
            const loadChatMessages = () => {
                chatMessagesContainer.innerHTML = "";
                chatMessages.forEach(msg => {
                    appendChatMessage(msg.sender, msg.message, msg.type, msg.bloodGroup);
                });
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Scroll to bottom
            };

            const appendChatMessage = (sender, message, type, bloodGroup = null) => {
                const messageElement = document.createElement("div");
                messageElement.classList.add("chat-message");
                messageElement.classList.add(type); // 'self', 'other', 'system'

                let senderName = `<strong>${sender}</strong>`;
                if (bloodGroup) {
                    senderName += `<span class="blood-group">${bloodGroup}</span>`;
                }

                messageElement.innerHTML = `${senderName}: ${message}`;
                chatMessagesContainer.appendChild(messageElement);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Auto-scroll to latest message
            };

            const handleSendMessage = () => {
                const messageText = chatMessageInput.value.trim();
                if (messageText) {
                    const message = {
                        sender: chatUsername,
                        message: messageText,
                        type: "self",
                        bloodGroup: chatUserBloodGroup // Include blood group
                    };
                    chatMessages.push(message);
                    localStorage.setItem("chatMessages", JSON.stringify(chatMessages));
                    appendChatMessage(message.sender, message.message, message.type, message.bloodGroup);
                    chatMessageInput.value = "";

                    // Simulate a simple "server" response after a short delay
                    setTimeout(() => {
                        const botResponses = [
                            "Hmm, an interesting thought...",
                            "Indeed.",
                            "The shadows whisper agreement.",
                            "Your words carry weight.",
                            "A keen observation, mortal.",
                            "I shall ponder this.",
                            "Very well.",
                        ];
                        const randomResponse = botResponses[Math.floor(Math.random() * botResponses.length)];
                        const botMessage = {
                            sender: "Mysterious Entity",
                            message: randomResponse,
                            type: "other",
                            bloodGroup: null // No blood group for bot
                        };
                        chatMessages.push(botMessage);
                        localStorage.setItem("chatMessages", JSON.stringify(chatMessages));
                        appendChatMessage(botMessage.sender, botMessage.message, botMessage.type, botMessage.bloodGroup);
                    }, 1000 + Math.random() * 1000); // 1-2 seconds delay
                }
            };

            // Event Listeners for Chat
            navChatIcon.addEventListener("click", (e) => {
                e.preventDefault(); // Prevent default link behavior
                if (!chatUsername) {
                    chatUsernameInputOverlay.style.display = "flex";
                    chatUsernameSetup.focus();
                } else {
                    globalChatWindow.classList.toggle("active");
                    if (globalChatWindow.classList.contains("active")) {
                        chatMessageInput.focus();
                        loadChatMessages(); // Load messages when chat opens
                    }
                }
            });

            closeChat.addEventListener("click", () => {
                globalChatWindow.classList.remove("active");
            });

            sendMessageButton.addEventListener("click", handleSendMessage);

            chatMessageInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    handleSendMessage();
                }
            });

            setChatUsernameButton.addEventListener("click", () => {
                const username = chatUsernameSetup.value.trim();
                if (username) {
                    chatUsername = username;
                    localStorage.setItem("chatUsername", chatUsername);
                    // Check if the user is a donor and get their blood group
                    const donor = donors.find(d => d.name.toLowerCase() === username.toLowerCase());
                    if (donor) {
                        chatUserBloodGroup = donor.group;
                        localStorage.setItem("chatUserBloodGroup", chatUserBloodGroup);
                    } else {
                        chatUserBloodGroup = null; // Ensure it's null if not a donor
                        localStorage.removeItem("chatUserBloodGroup");
                    }

                    chatUsernameInputOverlay.style.display = "none";
                    globalChatWindow.classList.add("active");
                    chatMessageInput.focus();
                    loadChatMessages(); // Load messages after setting username
                    addChatMessage("system", `${chatUsername} has entered the chat.`, "system");
                } else {
                    alert("Please enter a username to join the chat!");
                }
            });

            // Initial check for chat username on page load
            if (chatUsername) {
                loadChatMessages();
            } else {
                // If no username, the chat window will not open until username is set
                // You could add a prompt here or just wait for them to click the chat icon
            }
        });
    </script>
</body>
</html>
